import Head from "next/head";
import { signOut, getSession, signIn } from "next-auth/react";
import Layout from "../components/layourmain";
import TablePaginate from "../components/TablePaginate"

export default function Home(props) {
  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Layout>
        <div className="flex h-screen bg-black">
          <div className="w-screen h-screen flex flex-col space-y-5 justify-center items-center">
            <button
              className="w-24 bg-gray-200 px-6 rounded-md"
              onClick={() => {
                signIn();
              }}
            >
              Iniciar session
            </button>
            <button
              className="w-24 bg-gray-200 px-6 rounded-md"
              onClick={() => {
                signOut();
              }}
            >
              Cerrar session
            </button>
          </div>
          <TablePaginate props={props.tablejson}/>
        </div>
      </Layout>
    </>
  );
}

export async function getServerSideProps({ req }) {
  const session = await getSession({req});
  const tabledata = await fetch('http://localhost:3000/api/fichada');
  const tablejson = await tabledata.json()
  if (!session) {
    return {
      redirect: {
        destination: "/auth/login",
        permanent: false,
      },
    };
  }
  return {
    props: {sesion:session,tablejson},
  };
}
